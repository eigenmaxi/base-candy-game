<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Base Candy üç¨</title>

    <!-- FARCASTER META TAGS (STEP 2) -->
    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:name" content="Base Candy Game" />
    <meta property="fc:frame:icon_url" content="https://modu.ai/modu.svg" />
    <meta
      property="fc:frame:splash_image_url"
      content="https://modu.ai/modu.svg"
    />
    <meta property="fc:frame:splash_background_color" content="#8B5CF6" />
    <meta property="fc:frame:button:1" content="Play Game" />
    <meta property="fc:frame:button:1:action" content="link" />
    <meta
      property="fc:frame:button:1:target"
      content="https://base-candy-game.vercel.app"
    />

    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- Start Screen -->
    <div id="startScreen">
      <div class="start-content">
        <img src="images/base.png" class="start-base-logo" alt="Base logo" />
        <h1>Base Candy üç¨</h1>
        <p class="sub">Welcome to the sweetest Base community challenge</p>
        <p class="sub small">
          Match your favorite Layer 2 logos and climb the Based leaderboard.
        </p>
        <button id="startButton">Start Game</button>
        <div id="leaderboardPreview"></div>
      </div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdownOverlay" class="hidden">
      <div class="countdown-content">
        <div id="countdownNumber">3</div>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="gameBoardContainer" class="hidden">
      <div id="topbar">
        <div id="scoreBoard">Score: <span id="score">0</span></div>
        <div id="timerBoard">Time: <span id="time">60</span>s</div>
        <div id="controls">
          <button id="pauseBtn">Pause</button>
          <button id="muteBtn">üîä</button>
          <button id="resetBtn">Reset</button>
        </div>
      </div>

      <div id="gameBoard" aria-label="game board"></div>
    </div>

    <!-- End Screen -->
    <div id="endScreen" class="hidden">
      <div class="start-content">
        <img src="images/base.png" class="start-base-logo" alt="Base logo" />
        <h1>Game Over</h1>
        <p class="sub" id="compliment">Nice try!</p>
        <p class="sub">Your score: <span id="finalScore">0</span></p>

        <!-- Name Input Section -->
        <div id="nameInputSection" class="name-input-section">
          <input
            type="text"
            id="playerNameInput"
            placeholder="Enter your name"
            maxlength="20"
            class="name-input"
          />
          <button id="saveNameBtn" class="save-name-btn">Save Score</button>
        </div>

        <!-- Action Buttons Section -->
        <div id="actionButtons" class="hidden action-buttons">
          <button id="shareToFarcasterBtn" class="action-btn farcaster-btn">
            üì¢ Share on Farcaster
          </button>
          <button id="mintNFTBtn" class="action-btn mint-btn">
            üé® Mint Scorecard NFT
          </button>
          <div id="walletStatus" class="wallet-status"></div>
        </div>

        <div id="leaderboard"></div>
        <button id="restartButton">Play Again</button>
      </div>
    </div>

    <!-- Hidden canvas for scorecard generation -->
    <canvas
      id="scorecardCanvas"
      width="1000"
      height="1400"
      style="display: none"
    ></canvas>

    <!-- Audio elements for sound effects and music -->
    <audio id="bgMusic" loop>
      <source src="sounds/background-music.mp3" type="audio/mpeg" />
      <source src="sounds/background-music.ogg" type="audio/ogg" />
    </audio>
    <audio id="matchSound" preload="auto">
      <source src="sounds/match.mp3" type="audio/mpeg" />
      <source src="sounds/match.ogg" type="audio/ogg" />
    </audio>
    <audio id="specialSound" preload="auto">
      <source src="sounds/special.mp3" type="audio/mpeg" />
      <source src="sounds/special.ogg" type="audio/ogg" />
    </audio>
    <audio id="comboSound" preload="auto">
      <source src="sounds/combo.mp3" type="audio/mpeg" />
      <source src="sounds/combo.ogg" type="audio/ogg" />
    </audio>
    <audio id="invalidSound" preload="auto">
      <source src="sounds/invalid.mp3" type="audio/mpeg" />
      <source src="sounds/invalid.ogg" type="audio/ogg" />
    </audio>
    <audio id="winSound" preload="auto">
      <source src="sounds/win.mp3" type="audio/mpeg" />
      <source src="sounds/win.ogg" type="audio/ogg" />
    </audio>

    <!-- Load Farcaster SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@farcaster/frame-sdk@0.2.0/dist/index.global.js"></script>

    <!-- Initialize SDK -->
    <script>
      window.addEventListener("DOMContentLoaded", function () {
        if (window.sdk) {
          window.sdk.actions.ready();
          console.log("Farcaster SDK ready() called successfully");
        } else {
          console.error("Farcaster SDK not found");
        }
      });
    </script>

    <!-- Load Farcaster SDK first -->
    <script src="https://unpkg.com/@farcaster/frame-sdk@0.1.1/dist/index.js"></script>

    <!-- Initialize SDK -->
    <script>
      (function initFarcaster() {
        // Try multiple times in case SDK is still loading
        const maxAttempts = 10;
        let attempts = 0;

        const interval = setInterval(function () {
          attempts++;

          // Check if SDK is available
          if (window.sdk || window.frameSDK || window.FrameSDK) {
            const farcasterSDK =
              window.sdk || window.frameSDK || window.FrameSDK;

            // Call ready
            if (farcasterSDK.actions && farcasterSDK.actions.ready) {
              farcasterSDK.actions.ready();
              console.log("Farcaster SDK ready() called successfully");
              clearInterval(interval);
            }
          }

          // Stop trying after max attempts
          if (attempts >= maxAttempts) {
            console.warn("Could not initialize Farcaster SDK");
            clearInterval(interval);
          }
        }, 100);
      })();
    </script>

    <!-- Load ethers.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <!-- Load main game script -->
    <script src="main.js"></script>
  </body>
</html>
